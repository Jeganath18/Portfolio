name: Build and push Image as a package

on:
  push:
    branches: [ "main" ]

env:
  REGISTRY: ghcr.io
  IMAGE: ${{ github.repository }}
  TAG: latest

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # ------------------------------------
      # 1. Login to user's GHCR registry
      # ------------------------------------
      - name: Log in to GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GHCR_TOKEN }}

      # ------------------------------------
      # 2. Build Docker image
      # ------------------------------------
      - name: Build Docker Image
        run: |
          docker build -t ghcr.io/${IMAGE}:${TAG} .

      # ------------------------------------
      # 3. Push to user's GHCR registry
      # ------------------------------------
      - name: Push Image
        run: |
          docker push ghcr.io/${IMAGE}:${TAG}

      # ------------------------------------
      # 4. Notify your PaaS (simple webhook)
      # ------------------------------------
      # - name: Trigger Deployment on MyPaaS
      #   run: |
      #     curl -X POST https://api.my-paas.com/deploy \
      #       -H "Authorization: Bearer ${{ secrets.MYPAAS_API_KEY }}" \
      #       -H "Content-Type: application/json" \
      #       -d '{
      #         "image": "ghcr.io/'"${IMAGE}"':'"${TAG}"'",
      #         "project": "'"${{ github.repository }}"'"
      #       }'
